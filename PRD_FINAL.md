# ğŸ“˜ ebookgen â€” ìµœì¢… PRD

> ì´ë¯¸ì§€ ë¬¶ìŒì„ ê²€ìƒ‰ ê°€ëŠ¥í•œ PDF + í…ìŠ¤íŠ¸ íŒŒì¼ë¡œ ë³€í™˜í•˜ëŠ” ë¡œì»¬ ë„êµ¬

---

## 1. ì‹œìŠ¤í…œ ê°œìš”

### 1.1 ëª©ì 

í˜ì´ì§€ ì´ë¯¸ì§€ ë¬¶ìŒ (0001.png â€¦) ì„:
- **ê²€ìƒ‰ ê°€ëŠ¥í•œ PDF** (hidden text layer) ë¡œ ë³€í™˜
- **í…ìŠ¤íŠ¸ íŒŒì¼** (.txt) ìƒì„±
- ì—¬ëŸ¬ ê¶Œ ì˜ˆì•½ / ì¬ì‹œì‘ ê°€ëŠ¥í•˜ê²Œ ì²˜ë¦¬

### 1.2 íƒ€ê²Ÿ ì‚¬ìš©ì

| í˜ë¥´ì†Œë‚˜ | ë‹ˆì¦ˆ |
|---------|------|
| ìŠ¤ìº” ë³´ê´€ì | ìŠ¤ìº”í•œ ì±…ì„ ê²€ìƒ‰ ê°€ëŠ¥í•˜ê²Œ ë³´ê´€ |
| í•™ìŠµì | OCRëœ PDFì—ì„œ í…ìŠ¤íŠ¸ ì¶”ì¶œÂ·ë³µì‚¬ |
| ì •ë¦¬ì | ì—¬ëŸ¬ ê¶Œì„ í•œ ë²ˆì— ì¼ê´„ ë³€í™˜ |

### 1.3 í•µì‹¬ UX ì›ì¹™

> **"í´ë” ë„£ê³  â†’ ì‹¤í–‰ â†’ ë"**

- ì„¤ì • ì„ íƒì§€ **3ê°œ ì´í•˜**
- ë¸Œë¼ìš°ì € ì—…ë¡œë“œ ì—†ìŒ â€” íŒŒì¼ì‹œìŠ¤í…œ ì§ì ‘ ì‚¬ìš©
- ì‹¤íŒ¨í•´ë„ ê²°ê³¼ëŠ” ë°˜ë“œì‹œ ìƒì„±

---

## 2. ê¸°ìˆ  ìŠ¤íƒ

| ë ˆì´ì–´ | ì„ íƒ | ì´ìœ  |
|--------|------|------|
| **ì–¸ì–´** | Python 3.11+ | OCRÂ·PDF ìƒíƒœê³„ ìµœê°• |
| **PDF ìƒì„±** | img2pdf | ì´ë¯¸ì§€ ë¬´ì†ì‹¤ â†’ PDF ë³‘í•© |
| **OCR ì—”ì§„** | ocrmypdf + Tesseract 5 | hidden text layer ìƒì„±, `--sidecar` TXT ë™ì‹œ ì¶”ì¶œ |
| **PDF ì¡°ì‘** | pikepdf | í‘œì§€ ë¶„ë¦¬Â·ë³‘í•©, ë©”íƒ€ë°ì´í„° |
| **Web** | FastAPI + WebSocket | ë¹„ë™ê¸°, ì‹¤ì‹œê°„ ì§„í–‰ë¥  |
| **Frontend** | Vanilla HTML/CSS/JS | ì˜ì¡´ì„± ì œë¡œ |
| **DB** | SQLite | ìƒíƒœÂ·ì‘ì—… ê´€ë¦¬ |
| **íŒŒì¼ ê°ì‹œ** | watchdog | inbox ìë™ ê°ì§€ |
| **CLI** | typer | CLI-first ì¸í„°í˜ì´ìŠ¤ |
| **íŒ¨í‚¤ì§•** | Docker (ì„ íƒ) | ì‹œìŠ¤í…œ ì˜ì¡´ì„± ì¼ê´„ í•´ê²° |

---

## 3. ì „ì²´ ì•„í‚¤í…ì²˜

### 3.1 ì‹¤í–‰ ëª¨ë¸

```
UI (ë¡œì»¬ ì›¹)  /  CLI
       â†“
Job ë“±ë¡ (SQLite)
       â†“
Worker Loop (ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤, ë™ì‹œ 1ê¶Œ)
       â†“
5ë‹¨ê³„ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
```

### 3.2 ë ˆì´ì–´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Frontend (HTML/CSS/JS)           â”‚
â”‚         WebSocket â†• REST API             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            FastAPI Server                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚REST API â”‚  â”‚WebSocket â”‚  â”‚Watcher â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                     â–¼                    â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚             â”‚  Worker Loop â”‚             â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                    â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        Core Pipeline (5ë‹¨ê³„)       â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚  VALIDATE â†’ ASSEMBLE â†’ OCR â†’      â”‚  â”‚
â”‚  â”‚  OPTIMIZE â†’ FINALIZE              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                    â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  SQLite  â”‚  â”‚ manifest.json  â”‚        â”‚
â”‚  â”‚ (ì‘ì—…DB) â”‚  â”‚ (ë‹¨ê³„ë³„ ìƒíƒœ)   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             File System                  â”‚
â”‚  workspace/                              â”‚
â”‚  â”œâ”€â”€ inbox/      â† watchdog ê°ì‹œ         â”‚
â”‚  â””â”€â”€ books/{id}/ â† ì±… ë‹¨ìœ„ ìê¸°ì™„ê²°      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ë ˆì´ì–´ ì±…ì„

| ë ˆì´ì–´ | ì±…ì„ | ì›ì¹™ |
|--------|------|------|
| **CLI** | í•µì‹¬ ë³€í™˜ ì™„ì „ ë…ë¦½ ì‹¤í–‰ | CLIë§Œìœ¼ë¡œ 100% ë™ì‘ |
| **API** | CLI ìœ„ì˜ ì–‡ì€ HTTP ë ˆì´ì–´ | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í¬í•¨ ê¸ˆì§€ |
| **Frontend** | ìƒíƒœ ì‹œê°í™” + ì„¤ì • UI | ë¡œì§ ì—†ìŒ, API í˜¸ì¶œë§Œ |

> **CLI-first ì›ì¹™**: `ebookgen convert ./my-book/` í•œ ì¤„ë¡œ ë³€í™˜ ê°€ëŠ¥í•´ì•¼ í•¨.

---

## 4. ë””ë ‰í† ë¦¬ êµ¬ì¡°

### 4.1 í”„ë¡œì íŠ¸ êµ¬ì¡°

```
ebookgen/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/                    # í•µì‹¬ ë³€í™˜ (ì›¹ ì˜ì¡´ì„± ì—†ìŒ)
â”‚   â”‚   â”œâ”€â”€ validator.py         # ì…ë ¥ ê²€ì¦
â”‚   â”‚   â”œâ”€â”€ assembler.py         # img2pdf â†’ raw.pdf
â”‚   â”‚   â”œâ”€â”€ ocr.py               # ocrmypdf â†’ ocr.pdf + text.txt
â”‚   â”‚   â”œâ”€â”€ optimizer.py         # ìš©ëŸ‰ ìµœì í™”
â”‚   â”‚   â”œâ”€â”€ finalizer.py         # ìµœì¢… ì¶œë ¥ + report.json
â”‚   â”‚   â”œâ”€â”€ cover_handler.py     # í‘œì§€ ë¶„ë¦¬/ë°°ì¹˜
â”‚   â”‚   â””â”€â”€ pipeline.py          # 5ë‹¨ê³„ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
â”‚   â”‚
â”‚   â”œâ”€â”€ cli/
â”‚   â”‚   â””â”€â”€ main.py              # typer CLI
â”‚   â”‚
â”‚   â”œâ”€â”€ worker/
â”‚   â”‚   â””â”€â”€ loop.py              # Worker Loop
â”‚   â”‚
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ app.py               # FastAPI ì§„ì…ì 
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚       â”œâ”€â”€ books.py         # ì±… CRUD
â”‚   â”‚       â”œâ”€â”€ jobs.py          # ì‘ì—… ì‹¤í–‰/ìƒíƒœ
â”‚   â”‚       â””â”€â”€ ws.py            # WebSocket ì§„í–‰ë¥ 
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ database.py          # SQLite ì—°ê²°
â”‚   â”‚   â””â”€â”€ schemas.py           # Book, Job ìŠ¤í‚¤ë§ˆ
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ book_service.py
â”‚   â”‚   â”œâ”€â”€ job_service.py
â”‚   â”‚   â””â”€â”€ watcher_service.py   # inbox ê°ì‹œ
â”‚   â”‚
â”‚   â””â”€â”€ frontend/
â”‚       â”œâ”€â”€ index.html
â”‚       â”œâ”€â”€ css/styles.css
â”‚       â””â”€â”€ js/
â”‚           â”œâ”€â”€ app.js
â”‚           â”œâ”€â”€ dashboard.js
â”‚           â””â”€â”€ book-detail.js
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ fixtures/
â”‚
â”œâ”€â”€ example/                     # í…ŒìŠ¤íŠ¸ìš© ì˜ˆì‹œ ì±… (285p JPG)
â”‚
â”œâ”€â”€ workspace/                   # ëŸ°íƒ€ì„ ë°ì´í„° (gitignore)
â”‚   â”œâ”€â”€ inbox/
â”‚   â”œâ”€â”€ books/
â”‚   â””â”€â”€ db.sqlite
â”‚
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md
```

### 4.2 ëŸ°íƒ€ì„ ë°ì´í„° êµ¬ì¡° (ì±… ë‹¨ìœ„ ìê¸°ì™„ê²°)

```
workspace/
â”œâ”€â”€ inbox/                       # ì‚¬ìš©ìê°€ í´ë”ë¥¼ ë„£ëŠ” ê³³
â”‚   â””â”€â”€ my-book/                 # watchdogì´ ê°ì§€ â†’ books/ë¡œ ì´ë™
â”‚
â”œâ”€â”€ books/
â”‚   â””â”€â”€ {book_id}/               # ì±… 1ê¶Œ = ì™„ì „ ìê¸°ì™„ê²° ë””ë ‰í† ë¦¬
â”‚       â”œâ”€â”€ input/               # ì›ë³¸ ì´ë¯¸ì§€ (inboxì—ì„œ ì´ë™)
â”‚       â”‚   â”œâ”€â”€ 0001.jpg
â”‚       â”‚   â”œâ”€â”€ 0002.jpg
â”‚       â”‚   â””â”€â”€ ...
â”‚       â”œâ”€â”€ manifest.json        # ì„¤ì • + ë‹¨ê³„ë³„ ìƒíƒœ
â”‚       â”œâ”€â”€ stage/               # ì¤‘ê°„ ê²°ê³¼ë¬¼
â”‚       â”‚   â”œâ”€â”€ raw.pdf          # ASSEMBLE ê²°ê³¼
â”‚       â”‚   â”œâ”€â”€ ocr.pdf          # OCR ê²°ê³¼
â”‚       â”‚   â”œâ”€â”€ text.txt         # sidecar í…ìŠ¤íŠ¸
â”‚       â”‚   â””â”€â”€ logs.txt         # ì²˜ë¦¬ ë¡œê·¸
â”‚       â””â”€â”€ out/                 # ìµœì¢… ê²°ê³¼ë¬¼
â”‚           â”œâ”€â”€ book.pdf         # ê²€ìƒ‰ ê°€ëŠ¥í•œ PDF
â”‚           â”œâ”€â”€ book.txt         # ì „ì²´ í…ìŠ¤íŠ¸
â”‚           â””â”€â”€ report.json      # ë¦¬í¬íŠ¸
â”‚
â””â”€â”€ db.sqlite                    # ì‘ì—… ìƒíƒœ DB
```

---

## 5. ë°ì´í„° ëª¨ë¸

### 5.1 DB ìŠ¤í‚¤ë§ˆ (SQLite)

```sql
CREATE TABLE books (
    id          TEXT PRIMARY KEY,
    title       TEXT NOT NULL,
    total_pages INTEGER,
    total_size_mb REAL,
    status      TEXT NOT NULL DEFAULT 'pending',  -- pending|running|done|failed
    ocr_language TEXT DEFAULT 'kor+eng',
    optimize_mode TEXT DEFAULT 'basic',            -- basic|balanced|max
    error_policy TEXT DEFAULT 'skip',              -- skip|abort
    front_cover INTEGER,                           -- ì•í‘œì§€ í˜ì´ì§€ ë²ˆí˜¸
    back_cover  INTEGER,                           -- ë’¤í‘œì§€ í˜ì´ì§€ ë²ˆí˜¸
    created_at  DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at  DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE jobs (
    id          TEXT PRIMARY KEY,
    book_id     TEXT NOT NULL REFERENCES books(id),
    status      TEXT NOT NULL DEFAULT 'pending',   -- pending|running|done|failed
    scheduled_at DATETIME,
    started_at  DATETIME,
    finished_at DATETIME,
    error_message TEXT
);
```

### 5.2 manifest.json (íŒŒì¼ì‹œìŠ¤í…œ ìƒíƒœ ì¶”ì )

```json
{
  "book_id": "abc-123",
  "title": "Python Guide",
  "current_stage": "ocr",
  "stages": {
    "validate": "done",
    "assemble": "done",
    "ocr": "running",
    "optimize": "pending",
    "finalize": "pending"
  },
  "settings": {
    "ocr_language": "kor+eng",
    "optimize_mode": "basic",
    "error_policy": "skip",
    "front_cover": 1,
    "back_cover": 285
  }
}
```

> **ì´ì¤‘ ì¶”ì **: SQLite = ì‘ì—… í ê´€ë¦¬, manifest.json = íŒŒì´í”„ë¼ì¸ ë‹¨ê³„ë³„ ìƒíƒœ.
> í”„ë¡œì„¸ìŠ¤ê°€ ì£½ì–´ë„ íŒŒì¼ì‹œìŠ¤í…œë§Œ ë³´ë©´ ì–´ë””ê¹Œì§€ í–ˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆìŒ.

---

## 6. íŒŒì´í”„ë¼ì¸ ë‹¨ê³„ ì •ì˜ (5ë‹¨ê³„)

### Stage 1: VALIDATE

**ëª©ì **: ì´ë¯¸ì§€ ì •ë ¬, ëˆ„ë½/ì¤‘ë³µ ê²€ì‚¬, ì´ë¯¸ì§€ ì—´ê¸° í…ŒìŠ¤íŠ¸

```python
def validate(input_dir: Path) -> ValidationResult:
    files = sorted(input_dir.glob("*.jpg"))  # + png, tiff
    numbers = extract_numeric_prefix(files)

    missing = check_missing(numbers)    # ì—°ì† ë²ˆí˜¸ ë¹ˆí‹ˆ
    duplicates = check_duplicate(numbers)

    for f in files:
        open_image(f)  # ì†ìƒ ê²€ì‚¬

    # ì‹¤íŒ¨ â†’ ì¦‰ì‹œ ì¤‘ë‹¨, ì‹¤í–‰ ë²„íŠ¼ ë¹„í™œì„±í™”
```

| ìƒí™© | ì²˜ë¦¬ |
|------|------|
| ëˆ„ë½ í˜ì´ì§€ | ì¦‰ì‹œ ì‹¤íŒ¨ |
| ì¤‘ë³µ í˜ì´ì§€ | ì¦‰ì‹œ ì‹¤íŒ¨ |
| ì´ë¯¸ì§€ ì†ìƒ | ì¦‰ì‹œ ì‹¤íŒ¨ |

### Stage 2: ASSEMBLE

**ëª©ì **: ì´ë¯¸ì§€ë¥¼ ë¬´ì†ì‹¤ë¡œ PDF ë³‘í•© (ì¬ì••ì¶• ê¸ˆì§€, í˜ì´ì§€ í¬ê¸° = ì´ë¯¸ì§€ í¬ê¸°)

```python
import img2pdf

def assemble(input_dir: Path, output: Path) -> None:
    sorted_paths = sorted(input_dir.glob("*.jpg"))

    # í‘œì§€ ì¬ë°°ì—´
    pages = apply_cover_order(sorted_paths, front_cover, back_cover)

    with open(output / "stage" / "raw.pdf", "wb") as f:
        f.write(img2pdf.convert(pages))
```

**ì¶œë ¥**: `stage/raw.pdf`

### Stage 3: OCR

**ëª©ì **: ê²€ìƒ‰ ê°€ëŠ¥í•œ PDF + í…ìŠ¤íŠ¸ íŒŒì¼ ë™ì‹œ ìƒì„±

```python
# ocrmypdf ì‹¤í–‰
ocrmypdf.ocr(
    "stage/raw.pdf",
    "stage/ocr.pdf",
    language="kor+eng",
    sidecar="stage/text.txt",   # í…ìŠ¤íŠ¸ ë™ì‹œ ì¶”ì¶œ
    skip_big=50,                # 50MB ì´ˆê³¼ í˜ì´ì§€ ê±´ë„ˆë›°ê¸°
    tesseract_timeout=120,      # í˜ì´ì§€ë‹¹ 120ì´ˆ ì œí•œ
    jobs=cpu_count(),           # ë©€í‹°ì½”ì–´
    deskew=True,                # ê¸°ìš¸ê¸° ë³´ì •
    rotate_pages=True,          # íšŒì „ ë³´ì •
)
```

| ìƒí™© | ì²˜ë¦¬ |
|------|------|
| ì¼ë¶€ í˜ì´ì§€ ì‹¤íŒ¨ | `skip` â†’ ì´ë¯¸ì§€ë¡œë§Œ í¬í•¨, ê³„ì† ì§„í–‰ |
| ì „ì²´ ì‹¤íŒ¨ | ì‹¤íŒ¨ ì²˜ë¦¬ |
| ì‹¤íŒ¨ ëª©ë¡ | `logs.txt`ì— ê¸°ë¡ |

**ì¶œë ¥**: `stage/ocr.pdf`, `stage/text.txt`

### Stage 4: OPTIMIZE

**ëª©ì **: ìš©ëŸ‰ ìµœì í™”

| ëª¨ë“œ | ocrmypdf ì˜µì…˜ | ì„¤ëª… |
|------|--------------|------|
| `basic` | `-O 1` | êµ¬ì¡° ìµœì í™”ë§Œ (ë¬´ì†ì‹¤) |
| `balanced` | `-O 2` | JPEG ì¬ì••ì¶• (ì•½ê°„ ì••ì¶•) |
| `max` | `-O 3` | ê³µê²©ì  ì••ì¶• (í’ˆì§ˆ ì €í•˜ ê°€ëŠ¥) |

```python
ocrmypdf.ocr(
    "stage/ocr.pdf",
    "stage/optimized.pdf",
    optimize=level,
    skip_text=True,  # ì´ë¯¸ OCRëœ í˜ì´ì§€ ê±´ë„ˆë›°ê¸°
)
```

### Stage 5: FINALIZE

**ëª©ì **: ìµœì¢… íŒŒì¼ ë°°ì¹˜ + ë¦¬í¬íŠ¸ ìƒì„±

```python
def finalize(book_dir: Path) -> None:
    shutil.copy("stage/optimized.pdf", "out/book.pdf")
    shutil.copy("stage/text.txt", "out/book.txt")
    generate_report("out/report.json")
```

**report.json**:

```json
{
  "title": "Python Guide",
  "total_pages": 285,
  "ocr_success_pages": 283,
  "ocr_failed_pages": [129, 187],
  "processing_time_sec": 512,
  "input_size_mb": 120.4,
  "output_pdf_size_mb": 45.1,
  "output_txt_size_mb": 2.3,
  "compression_ratio": 0.37,
  "settings": {
    "ocr_language": "kor+eng",
    "optimize_mode": "basic",
    "error_policy": "skip"
  },
  "covers": {
    "front": 1,
    "back": 285
  },
  "created_at": "2026-02-25T23:00:00+09:00"
}
```

---

## 7. Worker ì„¤ê³„

### 7.1 Worker Loop

```python
while True:
    job = fetch_pending_job()  # scheduled_at <= now() í¬í•¨

    if job:
        mark_running(job)
        try:
            run_pipeline(job.book_id)
            mark_done(job)
        except Exception as e:
            mark_failed(job, str(e))

    sleep(5)
```

### 7.2 ì¬ì‹œì‘ ì²˜ë¦¬

```python
# í”„ë¡œê·¸ë¨ ì‹œì‘ ì‹œ
running_jobs = fetch_running_jobs()
for job in running_jobs:
    mark_failed(job, "Interrupted â€” ë¹„ì •ìƒ ì¢…ë£Œ")

# ì‚¬ìš©ìëŠ” ëŒ€ì‹œë³´ë“œì—ì„œ "ì¬ì‹œë„" ê°€ëŠ¥
# manifest.jsonì˜ current_stageë¶€í„° ì´ì–´ì„œ ì‹¤í–‰
```

### 7.3 ìŠ¤ì¼€ì¤„ë§

```python
# ì˜ˆì•½ ì‹¤í–‰: jobs.scheduled_at <= now() ì¸ pending ì‘ì—…ì„ Workerê°€ fetch
# UIì—ì„œëŠ” "ì§€ê¸ˆ ì‹¤í–‰" / "ë°¤ 2ì‹œì— ì‹¤í–‰" ë‘ ê°€ì§€ë§Œ ì œê³µ
```

---

## 8. ì‚¬ìš©ì íë¦„ (UI)

### 8.1 Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“˜ ebookgen                                      â”‚
â”‚                                                    â”‚
â”‚  [ + ì±… ì¶”ê°€ ]   [ â–¶ ì‹¤í–‰ ]   [ â° ì˜ˆì•½ ì‹¤í–‰ ]    â”‚
â”‚                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  ğŸ“š ì±… ëª©ë¡                                        â”‚
â”‚                                                    â”‚
â”‚  â˜‘ [ëŒ€ê¸°]  Python Guide    285p   120MB            â”‚
â”‚  â˜ [ì™„ë£Œ]  ML Book         312p   256MB    ğŸ“‚      â”‚
â”‚  â˜ [ì‹¤íŒ¨]  DB Manual       â€” missing page  âš ï¸      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                    â”‚
â”‚  inbox í´ë”: workspace/inbox                       â”‚
â”‚  â„¹ï¸  í´ë”ë¥¼ inboxì— ë„£ìœ¼ë©´ ìë™ìœ¼ë¡œ ì¸ì‹ë©ë‹ˆë‹¤      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ì±… ìƒì„¸ ì„¤ì •

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“˜ Python Guide                                   â”‚
â”‚  285 pages / 120MB                                 â”‚
â”‚                                                    â”‚
â”‚  â”€â”€ í‘œì§€ ì„ íƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  ì• 5í˜ì´ì§€:  [0001] [0002] [0003] [0004] [0005]   â”‚
â”‚  ë’¤ 5í˜ì´ì§€:  [0281] [0282] [0283] [0284] [0285]   â”‚
â”‚                                                    â”‚
â”‚  ì•í‘œì§€: (â—) 0001  ( ) ì—†ìŒ                        â”‚
â”‚  ë’¤í‘œì§€: (â—) 0285  ( ) ì—†ìŒ                        â”‚
â”‚                                                    â”‚
â”‚  â”€â”€ ì„¤ì • (3ê°œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                    â”‚
â”‚  1. OCR ì–¸ì–´:  [ í•œêµ­ì–´ + ì˜ì–´ â–¼ ]                 â”‚
â”‚                                                    â”‚
â”‚  2. ìš©ëŸ‰ ìµœì í™”:                                    â”‚
â”‚     (â—) ê¸°ë³¸ (í’ˆì§ˆ ìœ ì§€)                            â”‚
â”‚     ( ) ê· í˜• (ì•½ê°„ ì••ì¶•)                            â”‚
â”‚     ( ) ìµœëŒ€ ì••ì¶•                                   â”‚
â”‚                                                    â”‚
â”‚  3. ì‹¤íŒ¨ ì²˜ë¦¬:                                      â”‚
â”‚     (â—) ê±´ë„ˆë›°ê³  ê³„ì†                               â”‚
â”‚     ( ) ì˜¤ë¥˜ ì‹œ ì¤‘ë‹¨                                â”‚
â”‚                                                    â”‚
â”‚  [ â–¶ ì§€ê¸ˆ ì‹¤í–‰ ]  [ â° ì˜ˆì•½ ì‹¤í–‰ ]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 ì§„í–‰ë¥  (WebSocket ì‹¤ì‹œê°„)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“˜ Python Guide â€” ë³€í™˜ ì¤‘                         â”‚
â”‚                                                    â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  57%                   â”‚
â”‚                                                    â”‚
â”‚  âœ… 1/5 ì…ë ¥ ê²€ì‚¬ ì™„ë£Œ                              â”‚
â”‚  âœ… 2/5 PDF ìƒì„± ì™„ë£Œ                               â”‚
â”‚  ğŸ”„ 3/5 OCR ì²˜ë¦¬ ì¤‘... (162 / 285 pages)           â”‚
â”‚  â¬š 4/5 ìµœì í™”                                      â”‚
â”‚  â¬š 5/5 ì™„ë£Œ                                        â”‚
â”‚                                                    â”‚
â”‚  ê²½ê³¼: 8ë¶„ 12ì´ˆ  |  ì˜ˆìƒ ë‚¨ì€: ~6ë¶„                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.4 ì‹¤íŒ¨ UX

#### ì¼€ì´ìŠ¤ 1: ëˆ„ë½ í˜ì´ì§€ (ì‹¤í–‰ ì „ ì°¨ë‹¨)
```
âŒ í˜ì´ì§€ 0037 ëˆ„ë½
âŒ í˜ì´ì§€ 0042 ì¤‘ë³µ
â†’ [ì‹¤í–‰] ë²„íŠ¼ ë¹„í™œì„±í™”
```

#### ì¼€ì´ìŠ¤ 2: OCR ì¼ë¶€ ì‹¤íŒ¨ (ì™„ë£Œ + ê²½ê³ )
```
âœ… ì™„ë£Œ (ê²½ê³  ìˆìŒ)
ğŸ“„ book.pdf  |  ğŸ“„ book.txt  |  ğŸ“„ report.json
âš ï¸ OCR ì‹¤íŒ¨ í˜ì´ì§€: 129, 187 (ì´ë¯¸ì§€ë¡œë§Œ í¬í•¨)
```

#### ì¼€ì´ìŠ¤ 3: ì¤‘ë‹¨ í›„ ì¬ì‹œì‘
```
âš ï¸ ì´ì „ ì‘ì—…ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.
ë§ˆì§€ë§‰: Stage 3/5 (162/285 pages)
[ â–¶ ì´ì–´ì„œ ì§„í–‰ ]  [ ğŸ”„ ì²˜ìŒë¶€í„° ]
```

---

## 9. API ì„¤ê³„

### 9.1 REST Endpoints

| Method | Path | ì„¤ëª… |
|--------|------|------|
| `GET` | `/api/books` | ì „ì²´ ì±… ëª©ë¡ |
| `GET` | `/api/books/{id}` | ì±… ìƒì„¸ (manifest í¬í•¨) |
| `POST` | `/api/books` | ì±… ìˆ˜ë™ ì¶”ê°€ (ê²½ë¡œ ì§€ì •) |
| `PATCH` | `/api/books/{id}` | ì„¤ì • ë³€ê²½ |
| `DELETE` | `/api/books/{id}` | ì±… ì‚­ì œ |
| `GET` | `/api/books/{id}/preview` | í‘œì§€ ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ |
| `POST` | `/api/jobs` | ì‘ì—… ì‹¤í–‰ (ì¦‰ì‹œ/ì˜ˆì•½) |
| `GET` | `/api/jobs/{id}` | ì‘ì—… ìƒíƒœ |
| `POST` | `/api/jobs/{id}/cancel` | ì‘ì—… ì·¨ì†Œ |
| `POST` | `/api/jobs/{id}/retry` | ì¬ì‹œë„ |
| `GET` | `/api/output/{book_id}/{file}` | ê²°ê³¼ íŒŒì¼ ë‹¤ìš´ë¡œë“œ |

### 9.2 WebSocket

```
ws://localhost:8000/ws/jobs/{job_id}

// ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸
{
  "type": "progress",
  "step": 3,
  "step_name": "OCR ì²˜ë¦¬ ì¤‘",
  "pages_processed": 162,
  "pages_total": 285,
  "percent": 57,
  "elapsed_sec": 492,
  "eta_sec": 360
}
```

---

## 10. CLI ì¸í„°í˜ì´ìŠ¤

```bash
# ê¸°ë³¸ ë³€í™˜
ebookgen convert ./example/

# ì˜µì…˜ ì§€ì •
ebookgen convert ./example/ \
    --language kor+eng \
    --optimize balanced \
    --output ./output/ \
    --skip-errors

# ì—¬ëŸ¬ ê¶Œ ì¼ê´„ ë³€í™˜
ebookgen batch ./inbox/

# ëŒ€ì‹œë³´ë“œ ì„œë²„ ì‹œì‘
ebookgen serve --port 8000

# ìƒíƒœ í™•ì¸
ebookgen status
```

---

## 11. ë©”ëª¨ë¦¬ ê´€ë¦¬

| ì „ëµ | ì„¤ëª… |
|------|------|
| ì´ë¯¸ì§€ ìŠ¤íŠ¸ë¦¬ë° | í•œ ë²ˆì— ëª¨ë‘ ë©”ëª¨ë¦¬ì— ì˜¬ë¦¬ì§€ ì•ŠìŒ |
| img2pdf | ìŠ¤íŠ¸ë¦¬ë° ê¸°ë°˜ PDF ìƒì„± |
| ocrmypdf | subprocess ê¸°ë°˜ (íŒŒì¼ I/O) |
| ëª©í‘œ | **< 2GB** í”¼í¬ ë©”ëª¨ë¦¬ |

---

## 12. ì˜ˆì™¸ ì‹œë‚˜ë¦¬ì˜¤ í‘œ

| ìƒí™© | ì²˜ë¦¬ | ê²°ê³¼ë¬¼ |
|------|------|--------|
| ì´ë¯¸ì§€ ëˆ„ë½ | ì¦‰ì‹œ ì‹¤íŒ¨ | ì—†ìŒ |
| ì´ë¯¸ì§€ ì¤‘ë³µ | ì¦‰ì‹œ ì‹¤íŒ¨ | ì—†ìŒ |
| OCR ì¼ë¶€ ì‹¤íŒ¨ | skip â†’ ê³„ì† | PDF (ì´ë¯¸ì§€ í¬í•¨) |
| OCR ì „ì²´ ì‹¤íŒ¨ | ì‹¤íŒ¨ | ì—†ìŒ |
| í”„ë¡œì„¸ìŠ¤ ê°•ì œ ì¢…ë£Œ | ë‹¤ìŒ ì‹¤í–‰ ì‹œ ì¬ì‹œë„ | manifestì—ì„œ ë³µì› |
| ë””ìŠ¤í¬ ë¶€ì¡± | ì‹¤íŒ¨ | ì—†ìŒ |
| ì§€ì› ì•ˆ ë˜ëŠ” ì´ë¯¸ì§€ í˜•ì‹ | ì‹¤íŒ¨ | ì—†ìŒ |

---

## 13. ì„±ëŠ¥ ëª©í‘œ

| ë©”íŠ¸ë¦­ | ëª©í‘œ |
|--------|------|
| OCR ì²˜ë¦¬ ì†ë„ | < 3ì´ˆ/í˜ì´ì§€ (300 DPI, 4ì½”ì–´) |
| 285í˜ì´ì§€ ì˜ˆì‹œ ì±… | < 15ë¶„ |
| ë©”ëª¨ë¦¬ í”¼í¬ | < 2GB |
| ëŒ€ì‹œë³´ë“œ API ì‘ë‹µ | < 200ms |
| WebSocket ê°±ì‹  | ë§¤ 1ì´ˆ |

---

## 14. ì„¤ì¹˜ ë° ë°°í¬

### Option A: pip ì„¤ì¹˜ (ê¶Œì¥)

```bash
# ì‹œìŠ¤í…œ ì˜ì¡´ì„±
# Windows: choco install tesseract tesseract-langpack-kor
# macOS:   brew install tesseract tesseract-lang
# Linux:   apt install tesseract-ocr tesseract-ocr-kor

pip install ebookgen
ebookgen serve
```

### Option B: Docker

```bash
docker compose up -d
# http://localhost:8000
```

```yaml
services:
  ebookgen:
    build: .
    ports:
      - "8000:8000"
    volumes:
      - ./workspace:/app/workspace
```

---

## 15. ê°œë°œ ë§ˆì¼ìŠ¤í†¤

### Phase 1: Core Engine (1~2ì£¼)
- [ ] í”„ë¡œì íŠ¸ ì´ˆê¸°í™” (pyproject.toml)
- [ ] `validator.py` â€” ì…ë ¥ ê²€ì¦
- [ ] `assembler.py` â€” img2pdf â†’ raw.pdf
- [ ] `ocr.py` â€” ocrmypdf + sidecar
- [ ] `optimizer.py` â€” ìš©ëŸ‰ ìµœì í™”
- [ ] `finalizer.py` â€” ìµœì¢… ì¶œë ¥ + report.json
- [ ] `cover_handler.py` â€” í‘œì§€ ì¬ë°°ì—´
- [ ] `pipeline.py` â€” 5ë‹¨ê³„ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
- [ ] CLI (`ebookgen convert`)
- [ ] example/ í´ë”ë¡œ E2E ê²€ì¦

### Phase 2: Worker + DB (1ì£¼)
- [ ] SQLite ìŠ¤í‚¤ë§ˆ + ëª¨ë¸
- [ ] manifest.json ê´€ë¦¬
- [ ] Worker Loop
- [ ] ì¬ì‹œì‘/ì²´í¬í¬ì¸íŠ¸
- [ ] ìŠ¤ì¼€ì¤„ë§

### Phase 3: Web Dashboard (1~2ì£¼)
- [ ] FastAPI ì„œë²„ + REST API
- [ ] WebSocket ì§„í–‰ë¥ 
- [ ] Frontend â€” Dashboard
- [ ] Frontend â€” ì±… ìƒì„¸ ì„¤ì •
- [ ] Frontend â€” ì§„í–‰ë¥  í™”ë©´
- [ ] watchdog inbox ê°ì‹œ

### Phase 4: ì•ˆì •í™” (1ì£¼)
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (80%+)
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ (example/ í´ë” ì‚¬ìš©)
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”
- [ ] Docker íŒ¨í‚¤ì§•
- [ ] README ì‘ì„±

---

## 16. ì˜ë„ì ìœ¼ë¡œ í•˜ì§€ ì•ŠëŠ” ê²ƒ

| ê¸°ëŠ¥ | ì´ìœ  |
|------|------|
| âŒ EPUB ë³€í™˜ | ìŠ¤ì½”í”„ í™•ì¥ ë°©ì§€ |
| âŒ AI ë ˆì´ì•„ì›ƒ ë³µì› | ë³µì¡ì„± í­ë°œ |
| âŒ í´ë¼ìš°ë“œ ì˜ì¡´ | ë¡œì»¬ ë„êµ¬ ì •ì²´ì„± |
| âŒ ë¶„ì‚° ì²˜ë¦¬ | ê°œì¸ ì‚¬ìš©ì ë„êµ¬ |
| âŒ ì‚¬ìš©ì ê³„ì • | ë¡œì»¬ ë‹¨ì¼ ì‚¬ìš©ì |
| âŒ OCR ì—”ì§„ ìì²´ êµ¬í˜„ | ocrmypdf + Tesseract í™œìš© |
| âŒ ë³µì¡í•œ ìŠ¤ì¼€ì¤„ UI | "ì§€ê¸ˆ" / "ë°¤ 2ì‹œ" ë‘ ê°€ì§€ë§Œ |

---

## 17. í…ŒìŠ¤íŠ¸ ë°ì´í„°

| í•­ëª© | ê°’ |
|------|-----|
| ê²½ë¡œ | `example/` |
| í˜ì´ì§€ ìˆ˜ | 285 |
| í˜•ì‹ | JPG |
| ì´ ìš©ëŸ‰ | ~120MB |
| ìš©ë„ | E2E í…ŒìŠ¤íŠ¸, ê°œë°œ ì¤‘ ê²€ì¦ |

---

## 18. ì œí’ˆì˜ ë³¸ì§ˆ

> **ì´ë¯¸ì§€ ë¬¶ìŒì„ ì•ˆì •ì ìœ¼ë¡œ, ì‹¤íŒ¨í•´ë„ ëê¹Œì§€, ì ì€ í´ë¦­ìœ¼ë¡œ OCR ì±…ìœ¼ë¡œ ë§Œë“œëŠ” ë„êµ¬**

ê¸°ìˆ ì ìœ¼ë¡œ:
> img2pdf + ocrmypdfì˜ ë³€í™˜ ì—”ì§„ ìœ„ì—, **ë°°ì¹˜ ê´€ë¦¬ Â· ì²´í¬í¬ì¸íŠ¸ Â· ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ**ë¥¼ ì–¹ì€ ë¡œì»¬ ë„êµ¬
